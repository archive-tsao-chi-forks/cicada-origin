@module simple.Check

@import simple.Exp
@import simple.Ty
@import datatype.Map

{
  // |- (x) => x : (A) -> A
  // ~~~~~~ arrow_intro
  // x: A |- x: A
  // ~~~~~~ v
  // QED

  ctx = Map.empty
  x = Exp.v("x")
  A = Ty.atom("A")

  Check.arrow_intro(
    Check.v(Map.Lookup.here)
  ): Check(ctx, Exp.fn("x", x), Ty.arrow(A, A))

  Check(ctx, Exp.fn("x", x), Ty.arrow(A, A))
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.arrow_intro
  Check(Map.extend(ctx, "x", A), x, A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.v
  Map.Lookup(Map.extend(ctx, "x", A), "x", A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Map.Lookup.here
}

{
  // |- (x) => (y) => x : (A) -> (B) -> A
  // ~~~~~~ arrow_intro
  // x: A |- (y) => x : (B) -> A
  // ~~~~~~ arrow_intro
  // x: A, y: B |- x: A
  // ~~~~~~ v
  // QED

  ctx = Map.empty
  x = Exp.v("x")
  A = Ty.atom("A")
  B = Ty.atom("B")

  Check.arrow_intro(
    Check.arrow_intro(
      Check.v(Map.Lookup.there(Map.Lookup.here)))
  ): Check(ctx, Exp.fn("x", Exp.fn("y", x)), Ty.arrow(A, Ty.arrow(B, A)))

  Check(ctx, Exp.fn("x", Exp.fn("y", x)), Ty.arrow(A, Ty.arrow(B, A)))
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.arrow_intro
  Check(Map.extend(ctx, "x", A), Exp.fn("y", x), Ty.arrow(B, A))
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.arrow_intro
  Check(Map.extend(Map.extend(ctx, "x", A), "y", B), x, A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.v
  Map.Lookup(Map.extend(Map.extend(ctx, "x", A), "y", B), "x", A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Map.Lookup.there
  Map.Lookup(Map.extend(ctx, "x", A), "x", A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Map.Lookup.here
}

{
  // y: A |- {(x) => x}(y) : A
  // ~~~~~~ arrow_elim
  // { y: A |- (x) => x : (A) -> A
  //   ~~~~~~ arrow_intro
  //   y: A, x: A |- x : A
  //   ~~~~~~ v
  //   QED }
  // { y: A |- y: A
  //   ~~~~~~ v
  //   QED }
  // QED

  ctx = Map.extend(Map.empty, "y", Ty.atom("A"))
  x = Exp.v("x")
  y = Exp.v("y")
  id = Exp.fn("x", x)
  A = Ty.atom("A")

  Check.arrow_elim(
    A,
    Check.arrow_intro(Check.v(Map.Lookup.here)),
    Check.v(Lookup.here)): Check(ctx, Exp.ap(id, y), A)

  Check(ctx, Exp.ap(id, y), A)
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.arrow_elim
  { A: Ty }
  { Check(ctx, id, Ty.arrow(A, A))
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.arrow_intro
    Check(Map.extend(ctx, "x", A), x, A)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.v
    Map.Lookup(Map.extend(ctx, "x", A), "x", A)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Map.Lookup.here }
  { Check(ctx, y, A)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Check.v
    Map.Lookup(ctx, "y", A)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ Map.Lookup.here  }
}
