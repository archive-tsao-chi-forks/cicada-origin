#!/usr/bin/env node

const path = require("path")
const fg = require("fast-glob")
const changeCase = require("change-case")
const { run, expect, snapshot } = require("@xieyuheng/test-runner")

let commands = {}

commands.t = () => {
  commands.test_lib()
  commands.test_impression()
  commands.test_lang0()
  commands.test_lang1()
  commands.test_lang2()
}

commands.test_lib = () => {
  for (const file of fg.sync("lib/**/*.test.js")) {
    expect.ok(`node ${file}`)
  }
}

commands.test_impression = () => {
  for (const file of fg.sync("lib/**/*.impression.js")) {
    const out = path.resolve("snapshot", changeCase.paramCase(file) + ".out")
    snapshot.out(`node`, file, {
      snapshot: { out },
    })
  }
}

commands.test_lang0 = () => {
  snapshot.out("./bin/lang0.js", "tests/lang0/**.cic")
}

commands.test_lang1 = () => {
  snapshot.out("./bin/lang1.js", "tests/lang1/**.cic")
  snapshot.err("./bin/lang1.js", "tests/lang1-error/**.cic")
}

commands.test_lang2 = () => {
  snapshot.out("./bin/lang2.js", "tests/lang2/**.cic")
  snapshot.err("./bin/lang2.js", "tests/lang2-error/**.cic")
}

run(commands)
